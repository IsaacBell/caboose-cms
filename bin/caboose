#!/usr/bin/env ruby

require 'rails/all'
require 'caboose'
require 'caboose/engine'
require 'caboose/version'
require 'caboose/caboose_helper'

action = false
action = ARGV[0] if ARGV.count > 0

path = Dir.pwd
path = ARGV[1] if ARGV.count > 1
helper = CabooseHelper.new(path)

case action
  
when 'v', 'version'
  puts "Caboose CMS Version #{Caboose::VERSION}\n"
  exit

when 'help'
  puts "Usage:"
  puts "Create a new caboose app:"
  puts "  caboose new <app_path>"
  puts "Initialize an existing rails app as a new caboose app:"
  puts "  caboose init [<app_path>]"
  exit

when 'new'
  
  if (ARGV.count != 1)
    puts "Usage: caboose new <app_path>\n"
    exit
  end
  `rails new #{path} -d=mysql`  
  helper.init_all
  
when 'init'
  
  is_rails_app = File.exists(File.join(path, 'config', 'environment.rb'))  
  if (!is_rails_app)
    if (ARGV.count == 1)
      puts "Error: You don't seem to be in a rails app.\n"
    else
      puts "Error: The supplied path (#{path}) doesn't seem to be a rails app.\n"
    end
    exit 
  end
  helper.init_all
  
else
end

#!/usr/bin/env ruby

require 'rails/all'
require 'caboose'
require 'caboose/engine'
require 'caboose/version'
require 'caboose/caboose_helper'

def is_rails_app?(path)
  environment_path = File.join(path, 'config', 'environment.rb')
  File.exists?(environment_path)
end

action = false
action = ARGV[0] if ARGV.count > 0

if (action == '-v' || action == '--version')
  puts "Caboose CMS Version #{Caboose::VERSION}\n\n"
  exit
end

path = Dir.pwd
path = ARGV[1] if ARGV.count > 1

if (!is_rails_app?(path))
  if (ARGV.count == 1)
    puts "Error: You don't seem to be in a rails app.\n"
  else
    puts "Error: The supplied path (#{path}) doesn't seem to be a rails app.\n"
  end
  exit 
end

case action
when 'init'
  
  helper = CabooseHelper.new(path)
  helper.init_gem
  helper.init_app_config    
  helper.init_initializer
  helper.init_routes
  helper.init_assets
  helper.init_tinymce
  helper.init_session
  helper.remove_public_index
  #helper.drop_tables
  #helper.create_tables  
  #helper.init_data
  
else
end

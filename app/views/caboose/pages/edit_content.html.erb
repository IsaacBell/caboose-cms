
<textarea id='page_<%= @page.id %>_content' placeholder='Content' style='width: 600px; height: 400px;' class='tinymce'>
  <%= raw @page.content %>
</textarea>
<div id='message'></div>
<div id='controls'>
<input type='button' value='Close' onclick="modal.close();" />
<input type='button' value='Update' onclick="updateContent();" />
</div>

<% content_for :caboose_js do %>

  <%= javascript_include_tag "caboose/model/all" %>
  <%= javascript_include_tag "tinymce/preinit.js" %>
  <%= javascript_include_tag "tinymce/tinymce_jquery.js" %>
  <%= javascript_include_tag "tinymce/jquery.tinymce.js" %>
  <%= javascript_include_tag "tinymce-jquery.js" %>

  <script type="text/javascript">

  var modal = false;
  $(document).ready(function() {  
    modal = new CabooseModal(600, 475);
  });

  function updateContent()
  {
    tinymce.triggerSave();
    $.ajax({
      url: '/pages/<%= @page.id %>',
      type: 'put',
      data: {
        content: $('#page_<%= @page.id %>_content').val()
      },
      success: function(resp) {
        if (resp.success)
        {
          contentVal = $('#page_<%= @page.id %>_content').val();
          parent.$('#editmode_content_container').html(contentVal == null || contentVal.length == 0 ? 'No content.' : contentVal);
          modal.close();
        }
        if (resp.error)
          modal.autosize("<p class='note success'>" + resp.error + "</p>");
      }
    });
  }
  </script>
  <%= tinymce :caboose %>
<% end %>
